<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tri Cosm√©tique : Recyclable ou Perturbateur ?</title>
  <style>
    :root{
      --bg:#0b1020;/* nuit bleut√©e */
      --panel:#121a33;
      --card:#19254a;
      --accent:#8fd3ff;
      --accent-2:#b28bff;
      --good:#38d39f;
      --bad:#ff6b6b;
      --text:#eaf2ff;
      --muted:#b9c2d6;
      --shadow:0 10px 25px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, rgba(178,139,255,.15), transparent 60%),
                  radial-gradient(900px 600px at -10% 20%, rgba(143,211,255,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100svh;
      display:flex; flex-direction:column;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(10,15,30,.8), rgba(10,15,30,0));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px 20px}
    h1{margin:0;font-weight:800;letter-spacing:.2px;}
    .sub{color:var(--muted); margin-top:6px}
    .topbar{display:flex; gap:14px; align-items:center; flex-wrap:wrap; margin-top:14px}
    select, button, .pill{
      background:var(--panel); color:var(--text); border:1px solid rgba(255,255,255,.08);
      padding:10px 12px; border-radius:14px; box-shadow:var(--shadow);
      font-weight:600;
    }
    button{cursor:pointer; transition: transform .06s ease, background .2s}
    button:hover{transform:translateY(-1px)}
    .grid{
      display:grid; grid-template-columns: 340px 1fr; gap:18px; padding:20px
    }
    @media (max-width: 960px){.grid{grid-template-columns:1fr}}

    /* Panneaux */
    .panel{background:linear-gradient(185deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.09); border-radius:18px; padding:16px; box-shadow:var(--shadow)}

    /* Colonne gauche */
    .status{
      display:grid; grid-template-columns:1fr 1fr; gap:12px;
    }
    .bin{
      min-height:180px; background:var(--card); border-radius:14px; padding:12px; border:2px dashed rgba(255,255,255,.13);
      transition: border-color .2s, background .2s;
    }
    .bin h3{margin:0 0 8px 0}
    .bin[data-type="recyclable"]{--bin-color:var(--good)}
    .bin[data-type="perturbateur"]{--bin-color:var(--bad)}
    .bin .hint{color:var(--muted); font-size:.9rem}
    .bin.active{border-color:var(--bin-color); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02))}

    /* Cartes objets */
    .cards{margin-top:14px; display:grid; grid-template-columns:1fr; gap:12px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:12px; display:flex; align-items:center; gap:12px; box-shadow:var(--shadow);
      cursor:grab; user-select:none;
    }
    .dragging{opacity:.6; transform:scale(.98)}
    .material{font-size:.8rem; color:var(--muted)}
    .badge{font-size:.75rem; padding:6px 8px; border-radius:999px; font-weight:700}
    .badge.good{background:rgba(56,211,159,.16); border:1px solid rgba(56,211,159,.4);}
    .badge.bad{background:rgba(255,107,107,.14); border:1px solid rgba(255,107,107,.4);}
    .item-title{font-weight:700}

    /* Colonne droite */
    .play{display:grid; grid-template-columns:1fr; gap:16px}
    .scoreBox{display:flex; gap:10px; flex-wrap:wrap}
    .pill{display:inline-flex; align-items:center; gap:8px; font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}

    .board{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
    .dropzone{min-height:240px; border-radius:18px; padding:14px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:2px dashed rgba(255,255,255,.12);
      transition: border-color .2s, background .2s;
    }
    .dropzone h2{margin:0 0 10px 0}
    .dropzone[data-type="recyclable"]{--zone:var(--good)}
    .dropzone[data-type="perturbateur"]{--zone:var(--bad)}
    .dropzone.active{border-color:var(--zone); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03))}

    .actions{display:flex; gap:10px; justify-content:flex-end}

    /* Modale explications */
    dialog{border:none; border-radius:18px; padding:0; overflow:hidden; background:var(--panel); color:var(--text); box-shadow:var(--shadow);}
    dialog::backdrop{background:rgba(5,8,18,.6)}
    .modal{padding:18px}
    .modal h3{margin-top:0}
    .explain{display:grid; gap:10px}
    .explain .row{display:grid; gap:8px; background:var(--card); padding:12px; border-radius:14px; border:1px solid rgba(255,255,255,.1)}
    .explain .row .w{display:flex; gap:8px; align-items:center}

    /* Confetti */
    .confetti{position:fixed; inset:0; pointer-events:none}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>‚ôªÔ∏è Tri Cosm√©tique ‚Äî Recyclable ou Perturbateur du recyclage ?</h1>
      <div class="sub">Fais glisser chaque emballage dans la bonne zone selon le pays choisi. R√®gles simplifi√©es ‚Äî elles peuvent varier localement.</div>
      <div class="topbar">
        <label for="country">Pays :</label>
        <select id="country" aria-label="Choisir le pays">
          <option value="FR">France</option>
          <option value="DE">Allemagne</option>
          <option value="UK">Royaume-Uni</option>
          <option value="US">√âtats-Unis</option>
        </select>
        <button id="reshuffle">üîÅ M√©langer</button>
        <button id="reset">‚Ü©Ô∏è Recommencer</button>
        <span class="pill">‚è±Ô∏è <span id="timer">00:00</span></span>
        <span class="pill">‚≠ê Streak: <span id="streak">0</span></span>
        <span class="pill">üèÜ Score: <span id="score">0</span>/<span id="total">0</span></span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- Colonne gauche: Hints + Cartes -->
      <section class="panel">
        <h2 style="margin-top:0">üìò Aide rapide</h2>
        <div class="status">
          <div class="bin" data-type="recyclable">
            <h3>Recyclable</h3>
            <div class="hint">Bouteilles et flacons en PET/PE/PP, propres, formats > 5 cm, √©tiquettes <em>lavables/float</em>, mono-mat√©riau.</div>
          </div>
          <div class="bin" data-type="perturbateur">
            <h3>Perturbateur</h3>
            <div class="hint">Mix de mat√©riaux (miroirs, aimants), petite taille, pompes non s√©parables, √©tiquettes opaques couvrantes difficiles √† laver.</div>
          </div>
        </div>
        <div class="cards" id="cards"></div>
      </section>

      <!-- Colonne droite: Plateau de jeu -->
      <section class="panel play">
        <div class="scoreBox">
          <span class="pill"><span class="dot good"></span> Bon tri</span>
          <span class="pill"><span class="dot bad"></span> Mauvais tri</span>
        </div>
        <div class="board">
          <div class="dropzone" data-type="recyclable" aria-label="Zone Recyclable">
            <h2>üü¢ Recyclable</h2>
            <div class="zone-list" id="zone-recyclable"></div>
          </div>
          <div class="dropzone" data-type="perturbateur" aria-label="Zone Perturbateur">
            <h2>üî¥ Perturbateur du recyclage</h2>
            <div class="zone-list" id="zone-perturbateur"></div>
          </div>
        </div>
        <div class="actions">
          <button id="validate">Valider le tri</button>
          <button id="showExplanations">Voir les explications</button>
        </div>
      </section>
    </div>
  </main>

  <dialog id="explainDialog">
    <div class="modal">
      <h3>Explications par emballage (<span id="expCountry"></span>)</h3>
      <div class="explain" id="explainList"></div>
      <div style="text-align:right; margin-top:12px"><button onclick="document.getElementById('explainDialog').close()">Fermer</button></div>
    </div>
  </dialog>

  <canvas class="confetti" id="confetti"></canvas>

  <script>
  // --- Donn√©es du jeu ---
  // R√®gles simplifi√©es (p√©dagogiques, non contractuelles). Les pratiques varient localement.
  const ITEMS = [
    {
      id: 'abs-lipstick',
      name: 'Rouge √† l√®vres',
      material: 'ABS, petit format, √©l√©ments int√©gr√©s',
      icon: 'üíÑ',
      rules: {
        FR: {type:'perturbateur', why:'Petit format multi-pi√®ces (m√©canisme + d√©cor). Difficile √† trier et recycler.'},
        DE: {type:'perturbateur', why:'Petite taille et m√©lange de mat√©riaux ‚Üí sort au crible.'},
        UK: {type:'perturbateur', why:'Compact multi-mati√®res (ABS + inserts) non accept√© en flux standard.'},
        US: {type:'perturbateur', why:'La plupart des MRFs ne captent pas les petits objets multi-mati√®res.'}
      }
    },
    {
      id: 'pet-shampoo-opaque-label',
      name: 'Bouteille shampooing',
      material: 'PET transparent + √©tiquette opaque couvrante',
      icon: 'üß¥',
      rules: {
        FR: {type:'perturbateur', why:'√âtiquette opaque couvrante non d√©tachable/float ‚Üí perturbe l‚Äôidentification NIR et le lavage.'},
        DE: {type:'recyclable', why:'Si √©tiquette <em>wash-off</em>/float (pratique courante), la bouteille PET est recyclable.'},
        UK: {type:'perturbateur', why:'Sleeve opaque couvrant souvent class√© perturbateur s‚Äôil n‚Äôest pas <em>wash-off</em>.'},
        US: {type:'perturbateur', why:'Full-sleeve opaque non float ‚Üí accept√© de fa√ßon limit√©e; souvent perturbateur.'}
      }
    },
    {
      id: 'pp-jar-opaque',
      name: 'Pot de cr√®me',
      material: 'Polypropyl√®ne (PP) opaque',
      icon: 'ü´ô',
      rules: {
        FR: {type:'recyclable', why:'Flux tous plastiques : pots et barquettes PP g√©n√©ralement accept√©s (propres).'},
        DE: {type:'recyclable', why:'PP rigide (mono-mat√©riau) accept√© dans le sac jaune/PMC.'},
        UK: {type:'recyclable', why:'De nombreuses collectivit√©s acceptent les pots PP ; v√©rifier localement.'},
        US: {type:'perturbateur', why:'Acceptation variable selon les villes ; souvent non pris en charge en dehors des bouteilles/flacons.'}
      }
    },
    {
      id: 'pp-compact',
      name: 'Bo√Ætier de maquillage',
      material: 'PP avec charni√®re, miroir, d√©cor',
      icon: 'üéõÔ∏è',
      rules: {
        FR: {type:'perturbateur', why:'√âl√©ments multiples (charni√®re, miroir, aimant) ‚Üí composite difficile √† recycler.'},
        DE: {type:'perturbateur', why:'Objet composite/small parts ‚Üí tri d√©favorable.'},
        UK: {type:'perturbateur', why:'Pr√©sence de miroir/aimant ‚Üí perturbateur.'},
        US: {type:'perturbateur', why:'Petite taille + multi-mat√©riaux ‚Üí retrait au tri.'}
      }
    },
    {
      id: 'pe-bottle-opaque',
      name: 'Flacon de douche',
      material: 'PE (HDPE) opaque',
      icon: 'üßº',
      rules: {
        FR: {type:'recyclable', why:'Flacon PE rigide (bain/douche) accept√© en flux standard.'},
        DE: {type:'recyclable', why:'PE/HDPE rigide accept√© dans le sac jaune.'},
        UK: {type:'recyclable', why:'HDPE bottle g√©n√©ralement accept√©e (rincer, remettre le bouchon).'},
        US: {type:'recyclable', why:'Beaucoup de programmes acceptent les bouteilles HDPE (#2).'}
      }
    }
  ];

  const countryNames = {FR:'France', DE:'Allemagne', UK:'Royaume-Uni', US:'√âtats-Unis'};

  // --- √âtat ---
  const state = {
    country: 'FR',
    placements: {}, // itemId -> 'recyclable' | 'perturbateur' | undefined
    score: 0,
    total: ITEMS.length,
    streak: 0,
    startTime: Date.now(),
    timerInt: null
  };

  // --- Helpers UI ---
  const el = sel => document.querySelector(sel);
  const cardsEl = el('#cards');
  const zoneGood = el('#zone-recyclable');
  const zoneBad = el('#zone-perturbateur');

  function fmtTime(ms){
    const s = Math.floor(ms/1000); const m = Math.floor(s/60); const r = s%60;
    return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}`;
  }

  function startTimer(){
    state.startTime = Date.now();
    if(state.timerInt) clearInterval(state.timerInt);
    state.timerInt = setInterval(()=>{
      el('#timer').textContent = fmtTime(Date.now()-state.startTime);
    }, 500);
  }

  function updateHud(){
    el('#score').textContent = state.score;
    el('#total').textContent = state.total;
    el('#streak').textContent = state.streak;
  }

  // --- G√©n√©ration des cartes ---
  function renderCards(){
    cardsEl.innerHTML = '';
    shuffle([...ITEMS]).forEach(item => {
      const c = document.createElement('div');
      c.className = 'card';
      c.draggable = true;
      c.id = `card-${item.id}`;
      c.innerHTML = `
        <div style="font-size:28px">${item.icon}</div>
        <div style="flex:1">
          <div class="item-title">${item.name}</div>
          <div class="material">${item.material}</div>
        </div>
        <span class="badge">Glisser ‚Üí</span>
      `;
      attachDrag(c, item);
      cardsEl.appendChild(c);
    });
  }

  function attachDrag(card, item){
    card.addEventListener('dragstart', e=>{
      card.classList.add('dragging');
      e.dataTransfer.setData('text/plain', item.id);
    });
    card.addEventListener('dragend', ()=> card.classList.remove('dragging'));
  }

  // --- Dropzones ---
  document.querySelectorAll('.dropzone').forEach(zone=>{
    zone.addEventListener('dragover', e=>{e.preventDefault(); zone.classList.add('active');});
    zone.addEventListener('dragleave', ()=> zone.classList.remove('active'));
    zone.addEventListener('drop', e=>{
      e.preventDefault();
      zone.classList.remove('active');
      const id = e.dataTransfer.getData('text/plain');
      const item = ITEMS.find(i=>i.id===id);
      if(!item) return;
      placeCardInZone(id, zone.dataset.type);
    });
  });

  function placeCardInZone(itemId, zoneType){
    const card = document.getElementById(`card-${itemId}`);
    if(!card) return;
    // badge color
    const badge = card.querySelector('.badge');
    badge.className='badge ' + (zoneType==='recyclable'?'good':'bad');
    badge.textContent = zoneType==='recyclable' ? 'Recyclable' : 'Perturbateur';
    // move
    (zoneType==='recyclable'?zoneGood:zoneBad).appendChild(card);
    state.placements[itemId] = zoneType;
  }

  // --- Validation ---
  function validate(){
    let round = 0; let gained = 0; let streakOK = true;
    ITEMS.forEach(item=>{
      round++;
      const expected = item.rules[state.country].type;
      const given = state.placements[item.id];
      const card = document.getElementById(`card-${item.id}`);
      if(!given){streakOK=false; card?.animate([{transform:'translateX(0)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:180});return;}
      if(given===expected){
        gained++;
        flash(card, 'shadow: 0 0 0 2px var(--good) inset');
      } else {
        streakOK=false;
        flash(card, 'shadow: 0 0 0 2px var(--bad) inset');
      }
    });
    state.score = gained;
    state.streak = streakOK ? state.streak + 1 : 0;
    updateHud();
    if(gained===ITEMS.length){ confettiBurst(); }
  }

  function flash(elm, css){
    elm.animate([
      {boxShadow:'none'},
      {boxShadow:'0 0 0 6px rgba(255,255,255,.2) inset'},
      {boxShadow:'none'}
    ], {duration:500});
  }

  // --- Explications ---
  function openExplain(){
    const list = el('#explainList');
    list.innerHTML = '';
    el('#expCountry').textContent = countryNames[state.country];
    ITEMS.forEach(item=>{
      const rule = item.rules[state.country];
      const placed = state.placements[item.id];
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div class="w"><div style="font-size:22px">${item.icon}</div>
        <div style="font-weight:700">${item.name}</div></div>
        <div class="material">${item.material}</div>
        <div>
          <span class="badge ${rule.type==='recyclable'?'good':'bad'}">R√©f√©rence : ${rule.type==='recyclable'?'Recyclable':'Perturbateur'}</span>
          ${placed?`<span class="badge" style="margin-left:8px; border:1px dashed rgba(255,255,255,.3)">Ton tri : ${placed}</span>`:''}
        </div>
        <div>${rule.why}</div>
      `;
      list.appendChild(row);
    });
    el('#explainDialog').showModal();
  }

  // --- Confetti minimal ---
  const cf = document.getElementById('confetti');
  const ctx = cf.getContext('2d');
  let confs = [];
  function resize(){ cf.width = innerWidth; cf.height = innerHeight }
  addEventListener('resize', resize); resize();
  function confettiBurst(){
    confs = Array.from({length:120}, (_,i)=>({
      x: innerWidth/2 + (Math.random()-0.5)*120,
      y: innerHeight/3,
      r: Math.random()*3+2,
      vx: (Math.random()-0.5)*4,
      vy: Math.random()*-2 - 2,
      g: Math.random()*0.1 + 0.08,
      a: 1
    }));
    animateConfetti();
  }
  function animateConfetti(){
    ctx.clearRect(0,0,cf.width,cf.height);
    confs.forEach(p=>{
      p.vy += p.g; p.x += p.vx; p.y += p.vy; p.a -= .006;
      ctx.globalAlpha = Math.max(p.a,0);
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle = ['#8fd3ff','#b28bff','#38d39f','#ff6b6b'][Math.floor(Math.random()*4)]; ctx.fill();
    });
    ctx.globalAlpha = 1;
    confs = confs.filter(p=>p.a>0 && p.y<innerHeight+20);
    if(confs.length) requestAnimationFrame(animateConfetti);
  }

  // --- Utilitaires ---
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }

  function reshuffle(){
    // Remet toutes les cartes √† gauche, puis reg√©n√®re dans ordre al√©atoire
    state.placements = {}; state.score = 0; updateHud();
    renderCards();
  }

  function resetAll(){
    state.placements = {}; state.score = 0; state.streak = 0; updateHud();
    renderCards();
    zoneGood.innerHTML = ''; zoneBad.innerHTML = '';
    startTimer();
  }

  // --- Pays ---
  el('#country').addEventListener('change', e=>{
    state.country = e.target.value;
    // mettre √† jour badges de r√©f√©rence dans explications si ouvertes
    if(document.getElementById('explainDialog').open){ openExplain(); }
  });

  // --- Boutons ---
  el('#validate').addEventListener('click', validate);
  el('#showExplanations').addEventListener('click', openExplain);
  el('#reshuffle').addEventListener('click', reshuffle);
  el('#reset').addEventListener('click', resetAll);

  // --- Init ---
  (function init(){
    state.total = ITEMS.length; updateHud();
    renderCards();
    startTimer();
  })();

  // Accessibilit√© clavier (placer avec Entr√©e dans zone active)
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      const first = cardsEl.querySelector('.card');
      if(first){ placeCardInZone(first.id.replace('card-',''), 'recyclable'); }
    }
  })
  </script>
</body>
</html>
